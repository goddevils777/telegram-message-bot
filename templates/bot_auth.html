<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Å—Å–∏–π - Message Hunter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .auth-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 700px;
            width: 100%;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .method-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .method-tab {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .method-tab.active {
            background: #0088cc;
            color: white;
        }
        
        .method-content {
            display: none;
        }
        
        .method-content.active {
            display: block;
        }
        
        .step-box {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
        }
        
        .step-title {
            font-weight: 600;
            color: #0088cc;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .code-block {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
        }
        
        .btn {
            background: #0088cc;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            background: #006fa6;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .file-upload {
            border: 2px dashed #0088cc;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload:hover {
            border-color: #006fa6;
            background: #f0f8ff;
        }
        
        .file-upload.dragover {
            border-color: #28a745;
            background: #f8fff9;
        }
        
        #fileInput {
            display: none;
        }
        
        .sessions-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e1e8ed;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .session-item {
            padding: 15px;
            border-bottom: 1px solid #f1f3f4;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .session-item:last-child {
            border-bottom: none;
        }
        
        .session-info {
            text-align: left;
        }
        
        .session-name {
            font-weight: 600;
            color: #333;
        }
        
        .session-details {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="logo">üíª</div>
        <h1>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤</h1>
        <p class="subtitle">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ –º–µ—Ç–æ–¥–æ–≤ -->
        <div class="method-tabs">
            <button class="method-tab active" onclick="switchMethod('create')">
                üîß –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
            </button>
            <button class="method-tab" onclick="switchMethod('upload')">
                üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Å—Å–∏—é
            </button>
            <button class="method-tab" onclick="switchMethod('existing')">
                üìã –ì–æ—Ç–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏
            </button>
        </div>
        
        <!-- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ -->
        <div class="method-content active" id="createMethod">
            <div class="step-box">
                <div class="step-title">üîß –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª</div>
                <div>
                    1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞<br>
                    2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:<br>
                    <div class="code-block">python3 create_session_tool.py</div>
                    3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ<br>
                    4. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏—è –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –≥–æ—Ç–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π
                </div>
            </div>
            
            <button class="btn btn-success" onclick="createSessionTerminal()">
                üîß –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
            </button>
            
            <button class="btn" onclick="checkForNewSessions()">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π
            </button>
        </div>
        
        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Å—Å–∏–∏ -->
        <div class="method-content" id="uploadMethod">
            <div class="step-box">
                <div class="step-title">üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å–µ—Å—Å–∏–∏</div>
                <div>
                    –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã .session –∏ _info.json —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
                </div>
            </div>
            
            <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
                <div>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞</div>
                <div style="font-size: 14px; color: #666; margin-top: 10px;">
                    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: .session, .json
                </div>
            </div>
            
            <input type="file" id="fileInput" multiple accept=".session,.json">
        </div>
        
        <!-- –ì–æ—Ç–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏ -->
        <div class="method-content" id="existingMethod">
            <div class="step-box">
                <div class="step-title">üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Å—Å–∏–∏</div>
                <div>
                    –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Å—Å–∏—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ
                </div>
            </div>
            
            <div class="sessions-list" id="sessionsList">
                <div style="text-align: center; padding: 30px; color: #666;">
                    –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Å—Å–∏–π...
                </div>
            </div>
            
            <button class="btn" onclick="loadAvailableSessions()">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
            </button>
        </div>
        
        <div class="status-message" id="statusMessage"></div>
    </div>
    
    <script>
        function switchMethod(method) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã
            document.querySelectorAll('.method-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.method-content').forEach(content => content.classList.remove('active'));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã
            event.target.classList.add('active');
            document.getElementById(method + 'Method').classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
            if (method === 'existing') {
                loadAvailableSessions();
            }
        }
        
        async function createSessionTerminal() {
            showStatus('info', 'üîÑ –ó–∞–ø—É—Å–∫ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏... –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª!');
            
            try {
                const response = await fetch('/create_session_terminal', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showStatus('success', '‚úÖ –°–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫ –≥–æ—Ç–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π.');
                    setTimeout(() => {
                        switchMethod('existing');
                        loadAvailableSessions();
                    }, 2000);
                } else {
                    showStatus('error', `‚ùå ${data.error}`);
                }
            } catch (error) {
                showStatus('error', '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }
        
        async function loadAvailableSessions() {
            const listEl = document.getElementById('sessionsList');
            listEl.innerHTML = '<div style="text-align: center; padding: 30px; color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            
            try {
                const response = await fetch('/get_available_sessions');
                const data = await response.json();
                
                if (data.success && data.sessions.length > 0) {
                    listEl.innerHTML = data.sessions.map(session => `
                        <div class="session-item">
                            <div class="session-info">
                                <div class="session-name">${session.account_name}</div>
                                <div class="session-details">
                                    üë§ ${session.user_info.first_name} ${session.user_info.last_name}<br>
                                    üì± ${session.user_info.phone}
                                </div>
                            </div>
                            <button class="btn" onclick="useSession('${session.account_name}')">
                                ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
                            </button>
                        </div>
                    `).join('');
                } else {
                    listEl.innerHTML = '<div style="text-align: center; padding: 30px; color: #666;">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Å—Å–∏–π</div>';
                }
            } catch (error) {
                listEl.innerHTML = '<div style="text-align: center; padding: 30px; color: #dc3545;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }
        
        async function useSession(accountName) {
            try {
                const response = await fetch('/use_session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ account_name: accountName })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showStatus('success', '‚úÖ –°–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                } else {
                    showStatus('error', `‚ùå ${data.error}`);
                }
            } catch (error) {
                showStatus('error', '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }
        
        function checkForNewSessions() {
            loadAvailableSessions();
            showStatus('info', '–°–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω');
        }
        
        function showStatus(type, message) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = `status-message status-${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            if (type !== 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadAvailableSessions();
    </script>
</body>
</html>